{"remainingRequest":"C:\\Users\\Admin\\Desktop\\iceWk-vue-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Admin\\Desktop\\iceWk-vue-master\\src\\admin\\components\\ArticleDetail.vue?vue&type=style&index=0&id=16a06932&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\Admin\\Desktop\\iceWk-vue-master\\src\\admin\\components\\ArticleDetail.vue","mtime":1645886210948},{"path":"C:\\Users\\Admin\\Desktop\\iceWk-vue-master\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Admin\\Desktop\\iceWk-vue-master\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Admin\\Desktop\\iceWk-vue-master\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Admin\\Desktop\\iceWk-vue-master\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Admin\\Desktop\\iceWk-vue-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Admin\\Desktop\\iceWk-vue-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAaW1wb3J0ICJ+QC9zdHlsZXMvbWl4aW4uc2NzcyI7CgouY3JlYXRlUG9zdC1jb250YWluZXIgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKCiAgLmNyZWF0ZVBvc3QtbWFpbi1jb250YWluZXIgewogICAgcGFkZGluZzogNDBweCA0NXB4IDIwcHggNTBweDsKCiAgICAucG9zdEluZm8tY29udGFpbmVyIHsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICBAaW5jbHVkZSBjbGVhcmZpeDsKICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsKCiAgICAgIC5wb3N0SW5mby1jb250YWluZXItaXRlbSB7CiAgICAgICAgZmxvYXQ6IGxlZnQ7CiAgICAgIH0KICAgIH0KICB9CgogIC53b3JkLWNvdW50ZXIgewogICAgd2lkdGg6IDQwcHg7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICByaWdodDogNDAlOwogICAgdG9wOiAwcHg7CiAgfQp9CgouYXJ0aWNsZS10ZXh0YXJlYSA6OnYtZGVlcCB7CiAgdGV4dGFyZWEgewogICAgd2lkdGg6IDQ1JTsKICAgIHBhZGRpbmctcmlnaHQ6IDQwcHg7CiAgICByZXNpemU6IG5vbmU7CiAgICBib3JkZXI6IG5vbmU7CiAgICBib3JkZXItcmFkaXVzOiAwcHg7CiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2JmY2JkOTsKICB9Cn0K"},{"version":3,"sources":["ArticleDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4gBA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ArticleDetail.vue","sourceRoot":"src/admin/components","sourcesContent":["<template>\n  <div class=\"createPost-container\">\n    <el-form\n      ref=\"postForm\"\n      :model=\"postForm\"\n      :rules=\"rules\"\n      class=\"form-container\"\n    >\n      <sticky :z-index=\"10\" :class-name=\"'sub-navbar ' + postForm.status\">\n        <CommentDropdown v-model=\"postForm.comment_disabled\" />\n        <PlatformDropdown v-model=\"postForm.platforms\" />\n        <SourceUrlDropdown v-model=\"postForm.source_uri\" />\n        <el-button\n          v-loading=\"loading\"\n          style=\"margin-left: 10px\"\n          type=\"success\"\n          @click=\"submitForm\"\n        >\n          提交\n        </el-button>\n        <el-button v-loading=\"loading\" type=\"warning\" @click=\"draftForm\">\n          草稿\n        </el-button>\n      </sticky>\n\n      <div class=\"createPost-main-container\">\n        <el-row>\n          <Warning />\n\n          <el-col :span=\"24\">\n            <el-form-item style=\"margin-bottom: 40px\" prop=\"title\">\n              <MDinput\n                v-model=\"postForm.title\"\n                :maxlength=\"100\"\n                name=\"name\"\n                required\n              >\n                标题\n              </MDinput>\n            </el-form-item>\n\n            <div class=\"postInfo-container\">\n              <el-row>\n                <el-col :span=\"8\">\n                  <el-form-item\n                    label-width=\"60px\"\n                    label=\"作者:\"\n                    class=\"postInfo-container-item\"\n                    prop=\"author\"\n                  >\n                    <el-select\n                      v-model=\"postForm.author\"\n                      :remote-method=\"getRemoteUserList\"\n                      filterable\n                      default-first-option\n                      remote\n                      placeholder=\"选择作者\"\n                    >\n                      <el-option\n                        v-for=\"(item, index) in userListOptions\"\n                        :key=\"item + index\"\n                        :label=\"item\"\n                        :value=\"item\"\n                      />\n                    </el-select>\n                  </el-form-item>\n                </el-col>\n\n                <el-col :span=\"10\">\n                  <el-form-item\n                    label-width=\"120px\"\n                    label=\"发布时间:\"\n                    class=\"postInfo-container-item\"\n                  >\n                    <el-date-picker\n                      v-model=\"displayTime\"\n                      type=\"datetime\"\n                      format=\"yyyy-MM-dd HH:mm:ss\"\n                      placeholder=\"选择日期和时间\"\n                    />\n                  </el-form-item>\n                </el-col>\n\n                <el-col :span=\"6\">\n                  <el-form-item\n                    label-width=\"90px\"\n                    label=\"重要性:\"\n                    class=\"postInfo-container-item\"\n                  >\n                    <el-rate\n                      v-model=\"postForm.ownerTag\"\n                      :max=\"3\"\n                      :colors=\"['#99A9BF', '#F7BA2A', '#FF9900']\"\n                      :low-threshold=\"1\"\n                      :high-threshold=\"3\"\n                      style=\"display: inline-block\"\n                    />\n                  </el-form-item>\n                </el-col>\n              </el-row>\n            </div>\n          </el-col>\n        </el-row>\n\n          <el-row>\n         \n          <el-col :span=\"24\">\n\n\n            <div class=\"postInfo-container\">\n              <el-row>\n                <el-col :span=\"8\">\n                  <el-form-item\n                    label-width=\"60px\"\n                    label=\"作者:\"\n                    class=\"postInfo-container-item\"\n                    prop=\"author\"\n                  >\n                    <el-select\n                      v-model=\"postForm.author\"\n                      :remote-method=\"getRemoteUserList\"\n                      filterable\n                      default-first-option\n                      remote\n                      placeholder=\"选择作者\"\n                    >\n                      <el-option\n                        v-for=\"(item, index) in userListOptions\"\n                        :key=\"item + index\"\n                        :label=\"item\"\n                        :value=\"item\"\n                      />\n                    </el-select>\n                  </el-form-item>\n                </el-col>\n\n                <el-col :span=\"10\">\n                  <el-form-item\n                    label-width=\"120px\"\n                    label=\"发布时间:\"\n                    class=\"postInfo-container-item\"\n                  >\n                    <el-date-picker\n                      v-model=\"displayTime\"\n                      type=\"datetime\"\n                      format=\"yyyy-MM-dd HH:mm:ss\"\n                      placeholder=\"选择日期和时间\"\n                    />\n                  </el-form-item>\n                </el-col>\n\n                <el-col :span=\"6\">\n                  <el-form-item\n                    label-width=\"90px\"\n                    label=\"重要性:\"\n                    class=\"postInfo-container-item\"\n                  >\n                    <el-rate\n                      v-model=\"postForm.ownerTag\"\n                      :max=\"3\"\n                      :colors=\"['#99A9BF', '#F7BA2A', '#FF9900']\"\n                      :low-threshold=\"1\"\n                      :high-threshold=\"3\"\n                      style=\"display: inline-block\"\n                    />\n                  </el-form-item>\n                </el-col>\n              </el-row>\n            </div>\n          </el-col>\n        </el-row>\n       \n            <el-form-item\n              style=\"margin-top: 20px\"\n              label-width=\"70px\"\n              label=\"简介:\"\n            >\n              <el-input\n                v-model=\"postForm.intro\"\n                :rows=\"1\"\n                type=\"textarea\"\n                class=\"article-textarea\"\n                autosize\n                placeholder=\"简单介绍一下吧\"\n              />\n              <span v-show=\"contentShortLength\" class=\"word-counter\"\n                >{{ contentShortLength }}words</span\n              >\n            </el-form-item>\n         \n            <el-form-item\n              style=\"margin-top: -10px; transform: translateX(-20%)\"\n              label=\"标签:\"\n            >\n                <el-drag-select\n                  v-model=\"value\"\n                  style=\"width: 400px\"\n                  multiple\n                  placeholder=\"请选择\"\n                >\n                  <el-option\n                    v-for=\"item in options\"\n                    :key=\"item.value\"\n                    :label=\"item.label\"\n                    :value=\"item.value\"\n                  />\n                </el-drag-select>\n            </el-form-item>\n          \n                    <el-form-item\n          style=\"transform: translateY(-150%)\"\n          label-width=\"60px\"\n          label=\"分类:\"\n          class=\"postInfo-container-item\"\n          prop=\"author\"\n        >\n          <el-select\n            v-model=\"postForm.author\"\n            :remote-method=\"getRemoteUserList\"\n            filterable\n            default-first-option\n            remote\n            placeholder=\"选择分类\"\n          >\n            <el-option\n              v-for=\"(item, index) in userListOptions\"\n              :key=\"item + index\"\n              :label=\"item\"\n              :value=\"item\"\n            />\n          </el-select>\n          \n        </el-form-item>\n \n\n        <el-form-item prop=\"content\" style=\"margin-bottom: 30px\">\n          <Tinymce ref=\"editor\" v-model=\"postForm.content\" :height=\"400\" />\n        </el-form-item>\n\n        <el-form-item prop=\"image_uri\" style=\"margin-bottom: 30px\">\n          <Upload v-model=\"postForm.thumb\" />\n        </el-form-item>\n      </div>\n    </el-form>\n  </div>\n</template>\n\n<script>\n\n\nimport { validURL } from '@/utils/validate'\nimport { Todate } from '@/utils/date.js'\n\nimport ElDragSelect from '@/components/DragSelect' // base on element-ui\nimport Upload from '@/components/Upload/SingleImage'\nimport Sticky from '@/components/Sticky' // 粘性header组件\nimport Warning from './Warning'\nimport { CommentDropdown, PlatformDropdown, SourceUrlDropdown } from './Dropdown'\n\nimport { getArticleById } from '@/api/article'\nimport { getAllUserName } from '@/api/user'\nimport { createArticle } from '@/api/article'\n\nimport Tinymce from '@/components/Tinymce'\nimport MDinput from '@/components/MDinput'\n\nconst defaultForm = {\n  status: 'draft',\n  title: '', // 文章题目\n  content: '', // 文章内容\n  intro: '', // 文章摘要\n  source_uri: '', // 文章外链\n  // image_uri: '', // 文章图片\n  createTime: undefined, // 前台展示时间\n  id: undefined,\n  platforms: ['a-platform'],\n  comment_disabled: false,\n  ownerTag: 0\n}\n\nexport default {\n  name: 'ArticleDetail',\n  components: { ElDragSelect, Tinymce, MDinput, Upload, Sticky, Warning, CommentDropdown, PlatformDropdown, SourceUrlDropdown },\n  props: {\n    isEdit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    const validateRequire = (rule, value, callback) => {\n      if (value === '') {\n        this.$message({\n          message: rule.field + '为必传项',\n          type: 'error'\n        })\n        callback(new Error(rule.field + '为必传项'))\n      } else {\n        callback()\n      }\n    }\n    var listRule = (rule, value, callback) => {\n      undefined\n      if (this.postForm.author === '' || this.postForm.author === undefined || this.postForm.author === null) {\n        undefined\n        this.$message({\n          message: rule.field + '为必传项',\n          type: 'error'\n        })\n        callback(new Error(rule.field + '为必填字段'))\n      } else {\n        undefined\n        callback()\n      }\n    }\n    const validateSourceUri = (rule, value, callback) => {\n      if (value) {\n        /* eslint-disable */\n        if (validURL(value)) {\n          callback()\n        } else {\n          this.$message({\n            message: '外链url填写不正确',\n            type: 'error'\n          })\n          callback(new Error('外链url填写不正确'))\n        }\n      } else {\n        callback()\n      }\n    }\n    return {\n      value: ['Apple', 'Banana', 'Orange'],\n      options: [{\n        value: 'Apple',\n        label: 'Apple'\n      }, {\n        value: 'Banana',\n        label: 'Banana'\n      }, {\n        value: 'Orange',\n        label: 'Orange'\n      }, {\n        value: 'Pear',\n        label: 'Pear'\n      }, {\n        value: 'Strawberry',\n        label: 'Strawberry'\n      }],\n      articleid: '',\n      postForm: Object.assign({}, defaultForm),\n      loading: false,\n      userListOptions: [],\n      rules: {\n        image_uri: [{ validator: validateRequire }],\n        title: [{ validator: validateRequire }],\n        author: [{ validator: listRule }],\n        content: [{ validator: validateRequire }],\n        source_uri: [{ validator: validateSourceUri, trigger: 'blur' }]\n      },\n      tempRoute: {}\n    }\n  },\n  computed: {\n    contentShortLength() {\n      return this.postForm.intro.length\n    },\n    displayTime: {\n      // set and get is useful when the data\n      // returned by the back end api is different from the front end\n      // back end return => \"2013-06-25 06:59:25\"\n      // front end need timestamp => 1372114765000\n      get() {\n        return (+new Date(this.postForm.createTime))\n      },\n      set(val) {\n        this.postForm.createTime = new Date(val)\n        this.postForm.createTime = Todate(this.postForm.createTime)\n      }\n    }\n  },\n  created() {\n    //获取作者列表\n    this.getRemoteUserList()\n\n    //数据回填\n    if (this.isEdit) {\n      const id = this.$route.params && this.$route.params.id\n      this.articleid = this.$route.params.id\n      this.fetchData(id)\n      this.fetchData(this.articleid)\n    }\n\n    // Why need to make a copy of this.$route here?\n    // Because if you enter this page and quickly switch tag, may be in the execution of the setTagsViewTitle function, this.$route is no longer pointing to the current page\n    // https://github.com/PanJiaChen/vue-element-admin/issues/1221\n    this.tempRoute = Object.assign({}, this.$route)\n  },\n  methods: {\n\n    async fetchData(id) {\n      getArticleById(id).then(response => {\n        this.postForm = response.data\n        this.postForm.articleStatus = response.data.articleStatus\n        this.setTagsViewTitle()\n\n        // set page title\n        this.setPageTitle()\n      }).catch(err => {\n        console.log(err)\n      })\n    },\n    setTagsViewTitle() {\n      const title = '编辑文章'\n      const route = Object.assign({}, this.tempRoute, { title: `${title}-${this.postForm.id}` })\n      this.$store.dispatch('tagsView/updateVisitedView', route)\n    },\n    setPageTitle() {\n      const title = '编辑文章'\n      document.title = `${title} - ${this.postForm.id}`\n    },\n    submitForm() {\n      let that = this\n      console.log(this.postForm)\n      this.$refs.postForm.validate(valid => {\n        if (valid) {\n          this.loading = true\n          this.postForm.status = 'published'\n          console.log(this.postForm.id)\n          console.log(this.articleid)\n          that.fetchData(this.postForm.id)\n          that.fetchData(this.articleid)\n\n          setTimeout(() => {\n\n          }, 52000)\n          createArticle(that.postForm).then(resp => {\n            // console.log(that.postForm)\n            // console.log(resp)\n            //做一个简单的返回数据判断\n            if (resp.status === 200) {\n              console.log(resp)\n              //发布文章成功之后取回ArticleStatus\n              this.postForm.articleStatus = resp.data.articleStatus\n              this.postForm.id = resp.data.id\n              this.$notify({\n                title: '成功',\n                message: '发布文章成功',\n                type: 'success',\n                duration: 2000\n              })\n              this.postForm.status = 'published'\n              this.loading = false\n            } else {\n              console.log(\"保存失败\")\n            }\n          })\n            .catch((e) => {\n              console.log('error submit!!')\n              this.postForm.status = 'draft'\n              this.loading = false\n              this.$notify.error({\n                title: '失败',\n                message: '请检查网络连接',\n              })\n              return false\n            })\n\n        } else {\n          this.loading = false\n          console.log('error submit!!')\n          return false\n        }\n      })\n    },\n    draftForm() {\n      if (this.postForm.content.length === 0 || this.postForm.title.length === 0) {\n        this.$message({\n          message: '请填写必要的标题和内容',\n          type: 'warning'\n        })\n        return\n      }\n      var that = this\n      this.loading = true\n      this.postForm.status = 'draft'\n      //后端保存草稿处理\n      //再调用一次发布\n      createArticle(that.postForm).then(resp => {\n        // console.log(that.postForm)\n        // console.log(resp)\n        //做一个简单的返回数据判断\n        if (resp.status === 200) {\n          this.$message({\n            message: '保存成功',\n            type: 'success',\n            showClose: true,\n            duration: 1000\n          })\n          this.loading = false\n        } else {\n          console.log(\"保存失败\")\n          this.loading = false\n        }\n      })\n        .catch((e) => {\n          console.log('error submit!!')\n          this.loading = false\n          return false\n        })\n    },\n    getRemoteUserList(query) {\n      /* eslint-disable */\n      //获取作者列表\n      getAllUserName().then(resp => {\n        this.userListOptions = resp.data.map(o => { return [o.username].toString() })\n\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"~@/styles/mixin.scss\";\n\n.createPost-container {\n  position: relative;\n\n  .createPost-main-container {\n    padding: 40px 45px 20px 50px;\n\n    .postInfo-container {\n      position: relative;\n      @include clearfix;\n      margin-bottom: 10px;\n\n      .postInfo-container-item {\n        float: left;\n      }\n    }\n  }\n\n  .word-counter {\n    width: 40px;\n    position: absolute;\n    right: 40%;\n    top: 0px;\n  }\n}\n\n.article-textarea ::v-deep {\n  textarea {\n    width: 45%;\n    padding-right: 40px;\n    resize: none;\n    border: none;\n    border-radius: 0px;\n    border-bottom: 1px solid #bfcbd9;\n  }\n}\n</style>\n"]}]}